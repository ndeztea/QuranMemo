<?php 
// define surah
// @todo define all surah
$surahMuratal[1] = "Al-Fatiha";
$surahMuratal[2] = "Al-Baqara";
$surahMuratal[3] = "Aal-E-Imran";
$surahMuratal[4] = "An-Nisa";
$surahMuratal[5] = "Al-Maeda";
$surahMuratal[6] = "Al-Anaam";
$surahMuratal[7] = "Al-Araf";
$surahMuratal[8] = "Al-Anfal";
$surahMuratal[9] = "At-Tawba";
$surahMuratal[10] = "Yunus";
$surahMuratal[11] = "Hud";
$surahMuratal[12] = "Yusuf";
$surahMuratal[13] = "Ar-Rad";
$surahMuratal[14] = "Ibrahim";
$surahMuratal[15] = "Al-Hijr";
$surahMuratal[16] = "An-Nahl";
$surahMuratal[17] = "Al-Isra";
$surahMuratal[18] = "Al-Kahf";
$surahMuratal[19] = "Maryam";
$surahMuratal[20] = "Ta-Ha";
$surahMuratal[21] = "Al-Anbiya";
$surahMuratal[22] = "Al-Hajj";
$surahMuratal[23] = "Al-Mumenoon";
$surahMuratal[24] = "An-Noor";
$surahMuratal[25] = "Al-Furqan";
$surahMuratal[26] = "Ash-Shuara";
$surahMuratal[27] = "An-Naml";
$surahMuratal[28] = "Al-Qasas";
$surahMuratal[29] = "Al-Ankaboot";
$surahMuratal[30] = "Ar-Room";
$surahMuratal[31] = "Luqman";
$surahMuratal[32] = "As-Sajda";
$surahMuratal[33] = "Al-Ahzab";
$surahMuratal[34] = "Saba";
$surahMuratal[35] = "Fatir";
$surahMuratal[36] = "Ya-Seen";
$surahMuratal[37] = "As-Saaffat";
$surahMuratal[38] = "Sad";
$surahMuratal[39] = "Az-Zumar";
$surahMuratal[40] = "Al-Ghafir";
$surahMuratal[41] = "Fussilat";
$surahMuratal[42] = "Ash-Shura";
$surahMuratal[43] = "Az-Zukhruf";
$surahMuratal[44] = "Ad-Dukhan";
$surahMuratal[45] = "Al-Jathiya";
$surahMuratal[46] = "Al-Ahqaf";
$surahMuratal[47] = "Muhammad";
$surahMuratal[48] = "Al-Fath";
$surahMuratal[49] = "Al-Hujraat";
$surahMuratal[50] = "Qaf";
$surahMuratal[51] = "Adh-Dhariyat";
$surahMuratal[52] = "At-Tur";
$surahMuratal[53] = "An-Najm";
$surahMuratal[54] = "Al-Qamar";
$surahMuratal[55] = "Ar-Rahman";
$surahMuratal[56] = "Al-Waqia";
$surahMuratal[57] = "Al-Hadid";
$surahMuratal[58] = "Al-Mujadila";
$surahMuratal[59] = "Al-Hashr";
$surahMuratal[60] = "Al-Mumtahina";
$surahMuratal[61] = "As-Saff";
$surahMuratal[62] = "Al-Jumua";
$surahMuratal[63] = "Al-Munafiqoon";
$surahMuratal[64] = "At-Taghabun";
$surahMuratal[65] = "At-Talaq";
$surahMuratal[66] = "At-Tahrim";
$surahMuratal[67] = "Al-Mulk";
$surahMuratal[68] = "Al-Qalam";
$surahMuratal[69] = "Al-Haaqqa";
$surahMuratal[70] = "Al-Maarij";
$surahMuratal[71] = "Nooh";
$surahMuratal[72] = "Al-Jinn";
$surahMuratal[73] = "Al-Muzzammil";
$surahMuratal[74] = "Al-Muddaththir";
$surahMuratal[75] = "Al-Qiyama";
$surahMuratal[76] = "Al-Insan";
$surahMuratal[77] = "Al-Mursalat";
$surahMuratal[78] = "An-Naba";
$surahMuratal[79] = "An-Naziat";
$surahMuratal[80] = "Abasa";
$surahMuratal[81] = "At-Takwir";
$surahMuratal[82] = "Al-Infitar";
$surahMuratal[83] = "Al-Mutaffifin";
$surahMuratal[84] = "Al-Inshiqaq";
$surahMuratal[85] = "Al-Burooj";
$surahMuratal[86] = "Al-Ala";
$surahMuratal[87] = "At-Tariq";
$surahMuratal[88] = "Al-Ghashiya";
$surahMuratal[89] = "Al-Fajr";
$surahMuratal[90] = "Al-Balad";
$surahMuratal[91] = "Ash-Shams";
$surahMuratal[92] = "Al-Lail";
$surahMuratal[93] = "Ad-Dhuha";
$surahMuratal[94] = "Al-Inshirah";
$surahMuratal[95] = "At-Tin";
$surahMuratal[96] = "Al-Alaq";
$surahMuratal[97] = "Al-Qadr";
$surahMuratal[98] = "Al-Bayyina";
$surahMuratal[99] = "Az-Zalzala";
$surahMuratal[100] = "Al-Adiyat";
$surahMuratal[101] = "Al-Qaria";
$surahMuratal[102] = "At-Takathur";
$surahMuratal[103] = "Al-Asr";
$surahMuratal[104] = "Al-Fil";
$surahMuratal[105] = "Al-Humaza";
$surahMuratal[106] = "Al-Kauther";
$surahMuratal[107] = "Al-Maun";
$surahMuratal[108] = "Quraish";
$surahMuratal[109] = "Al-Kafiroon";
$surahMuratal[110] = "An-Nasr";
$surahMuratal[111] = "Al-Masadd";
$surahMuratal[112] = "Al-Ikhlas";
$surahMuratal[113] = "Al-Falaq";
$surahMuratal[114] = "An-Nas";

// set number arabic
$numberArabic[1] = '1';

?>

<script type="text/javascript">
$(document).ready(function(){

	var muratalPlaylist = new jPlayerPlaylist({
		jPlayer: "#muratalPlaylist",
		cssSelectorAncestor: "#muratalPlaylistContainer",

	},
	[
		// file list
		<?php foreach($ayats as $ayat):?>
		<?php if(($prev_surah!=$ayat->surah && $ayat->surah!=1 && $prev_surah!='') || ($prev_surah=='' && $ayat->ayat==1 && $ayat->surah!=1 ) ):?>
		{
			
			title:"section_<?php echo $ayat->page?>_<?php echo $ayat->surah?>_0",
			mp3: "<?php echo url('sound/hal_2/Al-Fatiha.001.mp3')?>"
		},
		<?php endif?>
		{
			
			title:"section_<?php echo $ayat->page?>_<?php echo $ayat->surah?>_<?php echo $ayat->ayat?>",
			<?php 
				$halMuratal = $ayat->page + 1;
				$ayatMp3 = $surahMuratal[$ayat->surah].'.'.str_pad($ayat->ayat, 3, "0", STR_PAD_LEFT).'.mp3';
			?>
			mp3: "<?php echo url('sound/hal_'.$halMuratal.'/'.$ayatMp3)?>"
		},
		<?php endforeach?>
	],
	{
		play: function(event) { 

			var ayat_selector = (event.jPlayer.status.media.title) 

			$('*','.mushaf').removeClass('playing');
			$('div.'+ayat_selector).addClass('playing');
			var tmpcurrentPlay = muratalPlaylist.current;
			var currentPlay = parseInt(tmpcurrentPlay) + 1;
			//console.log(muratalPlaylist.playlist.length+"="+ currentPlay);
			//console.log(ayat_selector);
			window.goNext = false;
			if(muratalPlaylist.playlist.length==currentPlay){
				window.goNext = true;
			}


			// repeat ayat
			var config_repeat = jQuery('.repeat').val();
        	var config_repeat_ayat = jQuery('.repeat_ayat').is(':checked');
        	if(config_repeat>1 && typeof repeat_ayat_counter=='undefined'){
        		repeat_ayat_counter = 1;
        	}

        	if(config_repeat_ayat==true){
        		if(repeat_ayat_counter<config_repeat){
        			console.log('repeat');
	        		jQuery('.jp-previous').click();
	        		repeat_ayat_counter++;
	        		console.log(repeat_ayat_counter);
	        		//jQuery('.repeat_ayat_counter').val(repeat_ayat);
	        	}else{
	        		//jQuery('.repeat_ayat_counter').val(1);
	        		repeat_ayat_counter = 0;
	        		console.log('next');
	        	}
        	}
			
        	



        }, 
        repeat: function(event) {
		  if(event.jPlayer.options.loop) {
		    $(this).unbind(".jPlayerRepeat").bind($.jPlayer.event.ended + ".jPlayer.jPlayerRepeat", function() {
		      $(this).jPlayer("play");
		    });
		  } else {
		    $(this).unbind(".jPlayerRepeat");
		  }
		},
        end: function(event){
        	$('*','.view-quran').removeClass('playing');
        },
        ended: function(event){
        							        	//alert(muratalPlaylist.current);
        	//var endPlaylist = muratalPlaylist.current;
        	//alert(endPlaylist+'==23');
        	//var totalAyat = $('.flag-ayat').length;

        	// jqplayer cant check thelatest playlist, the result always -1
        	// use this code to fix this
        	//endPlaylist = endPlaylist+1;
        	//console.log(muratalPlaylist.timeupdate);
        	//console.log(muratalPlaylist.playlist.length+"="+endPlaylist);

        	var repeat_surah = 1;
        	var config_repeat_surah = jQuery('.repeat_surah').is(':checked');

        	<?php if(!isset($on_memo)):?>
        	if(window.goNext==true){
        		// stop play
        		$(this).jPlayer("stop");
        		if(jQuery('#automated_play').is(':checked')){
	        		<?php if($curr_page<604): $next_page = $curr_page + 1?>
		    		location.href = '<?php echo url('mushaf/page/'.$next_page)?>/autoplay';//http://semutmedia.com/qmt_class/alquran/mushaf_normal/295/autoplay';
		    		<?php endif?>
		    	}
        	}	
        	<?php endif?>
        	
        },
		playlistOptions: { 
			<?php if(Request::segment(4)=='autoplay'):?>
			autoPlay: true 
			<?php endif?>
		},
          
		swfPath: "http://jplayer.org/latest/js",
		useStateClassSkin: true,
		autoBlur: false,
		smoothPlayBar: true,
		keyEnabled: true,
		loop:true
	});
	
	<?php $a=0;foreach($ayats as $ayat):?>

	<?php if(($prev_surah!=$ayat->surah && $ayat->surah!=1 && $prev_surah!='') || ($prev_surah=='' && $ayat->ayat==1 && $ayat->surah!=1 ) ):?>
	//muratalPlaylist.play();
	<?php $a++; endif?>
	
	jQuery('.play_<?php echo $a?>').click(function(){
		muratalPlaylist.play(<?php echo $a?>);
	});
	<?php $a++;endforeach?>
	//$("#jplayer_inspector_1").jPlayerInspector({jPlayer:$("#jquery_jplayer_1")});
});
</script>
<div class="quran_player animated fadeInUp">
	<div id="muratalPlaylistContainer" class="jp-video jp-video-270p" role="application" aria-label="media player">
		<div class="jp-type-playlist">
			<div id="muratalPlaylist" class="jp-jplayer"></div>
			<div class="jp-gui">
				<div class="jp-video-play">
					<button class="jp-video-play-icon" role="button" tabindex="0">play</button>
				</div>
				<div class="jp-interface">
					<div class="jp-progress">
						<div class="jp-seek-bar">
							<div class="jp-play-bar"></div>
						</div>
					</div>
					<div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>
					<div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>
					<div class="jp-controls-holder">
						<div class="jp-controls">
							<button class="jp-previous" role="button" tabindex="0">previous</button>
							<button class="jp-play" role="button" tabindex="0">play</button>
							<button class="jp-next" id="playlist-pause" role="button" tabindex="0">next</button>
							<button class="jp-stop" role="button" tabindex="0">stop</button>
						</div>
						<div class="jp-volume-controls">
							<button class="jp-mute" role="button" tabindex="0">mute</button>
							<button class="jp-volume-max" role="button" tabindex="0">max volume</button>
							<div class="jp-volume-bar">
								<div class="jp-volume-bar-value"></div>
							</div>
						</div>
						
						<div class="jp-toggles">
							<button class="jp-repeat" role="button" tabindex="0">repeat</button>
							<!--button class="jp-shuffle" role="button" tabindex="0">shuffle</button-->
						</div>
						<div>
						ulangi
						</div>
					</div>
					<div class="jp-details">
						<div class="jp-title" aria-label="title">&nbsp;</div>
					</div>
				</div>
			</div>
			<div class="jp-playlist" style="display:none">
				<ul>
					<!-- The method Playlist.displayPlaylist() uses this unordered list -->
					<li>&nbsp;</li>
				</ul>
			</div>
			<div class="jp-no-solution">
				<span>Update Required</span>
				To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
			</div>
		</div>
	</div>
</div>